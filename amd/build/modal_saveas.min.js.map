{"version":3,"sources":["../src/modal_saveas.js"],"names":["define","$","Notification","CustomEvents","Modal","ModalRegistry","Templates","displayNotification","error","type","require","notification","str","errorIsAvailable","get_string","when","done","localizedStr","addNotification","message","SELECTORS","LOADING_ICON_CONTAINER","SECTION","BUTTON","CONTAINER","showLoadingIcon","body","find","removeClass","hideLoadingIcon","addClass","ModalSaveas","root","call","selectedSection","saveAsData","CMID","courseid","TYPE","prototype","Object","create","constructor","registerEventListeners","modal","getModal","on","e","selected","previousSection","getBody","classList","remove","button","getFooter","removeAttribute","target","add","parseInt","id","split","bind","section","ajax","M","cfg","wwwroot","dataType","data","fail","always","hide","renderSections","cmid","response","sections","render","then","html","js","container","replaceNode","show","setAttribute","get","register"],"mappings":"AAsBAA,OAAM,qCAAC,CAAC,QAAD,CAAW,mBAAX,CAAgC,gCAAhC,CAAkE,YAAlE,CAAgF,qBAAhF,CAAuG,gBAAvG,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAA0BC,CAA1B,CAAwCC,CAAxC,CAA+CC,CAA/C,CAA8DC,CAA9D,CAAyE,IAEjEC,CAAAA,CAAmB,CAAG,SAASC,CAAT,CAAgBC,CAAhB,CAAsB,CAC5CC,OAAO,CAAC,CAAC,mBAAD,CAAD,CAAwB,SAASC,CAAT,CAAuB,CAClDD,OAAO,CAAC,CAAC,UAAD,CAAD,CAAe,SAASE,CAAT,CAAc,CAChC,GAAIC,CAAAA,CAAgB,CAAGD,CAAG,CAACE,UAAJ,CAAeN,CAAf,CAAsB,kBAAtB,CAAvB,CACAP,CAAC,CAACc,IAAF,CAAOF,CAAP,EAAyBG,IAAzB,CAA8B,SAASC,CAAT,CAAuB,CACjDN,CAAY,CAACO,eAAb,CAA6B,CACzBC,OAAO,CAAEF,CADgB,CAEzBR,IAAI,CAAEA,CAFmB,CAA7B,CAIH,CALD,CAMH,CARM,CASV,CAVM,CAWV,CAdoE,CAgBjEW,CAAS,CAAG,CACZC,sBAAsB,CAAE,0CADZ,CAEZC,OAAO,CAAE,kCAFG,CAGZC,MAAM,CAAE,iCAHI,CAIZC,SAAS,CAAE,YAJC,CAhBqD,CA4BjEC,CAAe,CAAG,SAASC,CAAT,CAAe,CACjCA,CAAI,CAACC,IAAL,CAAUP,CAAS,CAACC,sBAApB,EAA4CO,WAA5C,CAAwD,QAAxD,CACH,CA9BoE,CAqCjEC,CAAe,CAAG,SAASH,CAAT,CAAe,CACjCA,CAAI,CAACC,IAAL,CAAUP,CAAS,CAACC,sBAApB,EAA4CS,QAA5C,CAAqD,QAArD,CACH,CAvCoE,CA8CjEC,CAAW,CAAG,SAASC,CAAT,CAAe,CAC7B5B,CAAK,CAAC6B,IAAN,CAAW,IAAX,CAAiBD,CAAjB,EACA,KAAKE,eAAL,CAAuB,IAAvB,CACA,KAAKC,UAAL,CAAkB,IAAlB,CACA,KAAKC,IAAL,CAAY,IAAZ,CACA,KAAKC,QAAL,CAAgB,IACnB,CApDoE,CAsDrEN,CAAW,CAACO,IAAZ,CAAmB,mCAAnB,CACAP,CAAW,CAACQ,SAAZ,CAAwBC,MAAM,CAACC,MAAP,CAAcrC,CAAK,CAACmC,SAApB,CAAxB,CACAR,CAAW,CAACQ,SAAZ,CAAsBG,WAAtB,CAAoCX,CAApC,CAOAA,CAAW,CAACQ,SAAZ,CAAsBI,sBAAtB,CAA+C,UAAW,CACtDvC,CAAK,CAACmC,SAAN,CAAgBI,sBAAhB,CAAuCV,IAAvC,CAA4C,IAA5C,EAEA,GAAIW,CAAAA,CAAK,CAAG,IAAZ,CACA,KAAKC,QAAL,GAAgBC,EAAhB,CAAmB,OAAnB,CAA4B1B,CAAS,CAACE,OAAtC,CAA+C,SAASyB,CAAT,CAAY,CACvD,GAAIC,CAAAA,CAAQ,CAAGJ,CAAK,CAACV,eAArB,CACA,GAAiB,IAAb,GAAAc,CAAJ,CAAuB,CACnB,GAAIC,CAAAA,CAAe,CAAGL,CAAK,CAACM,OAAN,GAAgBvB,IAAhB,CAAqB,mBAAqBqB,CAA1C,EAAoD,CAApD,CAAtB,CACAC,CAAe,CAACE,SAAhB,CAA0BC,MAA1B,CAAiC,0CAAjC,CACH,CACD,GAAIC,CAAAA,CAAM,CAAGT,CAAK,CAACU,SAAN,GAAkB3B,IAAlB,CAAuBP,CAAS,CAACG,MAAjC,EAAyC,CAAzC,CAAb,CACA8B,CAAM,CAACE,eAAP,CAAuB,UAAvB,EACAR,CAAC,CAACS,MAAF,CAASL,SAAT,CAAmBM,GAAnB,CAAuB,0CAAvB,EACAb,CAAK,CAACV,eAAN,CAAwBwB,QAAQ,CAACX,CAAC,CAACS,MAAF,CAASG,EAAT,CAAYC,KAAZ,CAAkB,GAAlB,EAAuB,CAAvB,CAAD,CACnC,CAVD,EAUGC,IAVH,CAUQ,IAVR,EAYA,KAAKhB,QAAL,GAAgBC,EAAhB,CAAmB,OAAnB,CAA4B1B,CAAS,CAACG,MAAtC,CAA8C,UAAW,CACrDqB,CAAK,CAACT,UAAN,CAAiB2B,OAAjB,CAA2BlB,CAAK,CAACV,eAAjC,CACAjC,CAAC,CAAC8D,IAAF,CAAOC,CAAC,CAACC,GAAF,CAAMC,OAAN,6EACkEtB,CAAK,CAACR,IADxE,CAAP,CACuF,CACnF3B,IAAI,CAAE,MAD6E,CAEnF0D,QAAQ,CAAE,MAFyE,CAGnFC,IAAI,CAAExB,CAAK,CAACT,UAHuE,CADvF,EAKGnB,IALH,CAKQ,UAAM,CACVT,CAAmB,CAAC,eAAD,CAAkB,SAAlB,CACtB,CAPD,EAOG8D,IAPH,CAOQ,UAAM,CACV9D,CAAmB,CAAC,aAAD,CAAgB,OAAhB,CACtB,CATD,EASG+D,MATH,CASU,UAAM,CACZ1B,CAAK,CAAC2B,IAAN,EACH,CAXD,CAYH,CAdD,EAcGV,IAdH,CAcQ,IAdR,CAeH,CA/BD,CAiCA9B,CAAW,CAACQ,SAAZ,CAAsBiC,cAAtB,CAAuC,SAAS9C,CAAT,CAAe+C,CAAf,CAAqBpC,CAArB,CAA+B,CAClE,GAAIO,CAAAA,CAAK,CAAG,IAAZ,CACAnB,CAAe,CAACC,CAAD,CAAf,CACAzB,CAAC,CAAC8D,IAAF,CAAOC,CAAC,CAACC,GAAF,CAAMC,OAAN,+EAAuFO,CAAvF,CAAP,CAAsG,CAClGhE,IAAI,CAAE,KAD4F,CAElG0D,QAAQ,CAAE,MAFwF,CAGlGC,IAAI,CAAE,CAAC/B,QAAQ,CAAEA,CAAX,CAH4F,CAAtG,EAIGrB,IAJH,CAIQ,SAAC0D,CAAD,CAAc,CAClB,GAAIC,CAAAA,CAAQ,CAAGD,CAAQ,CAACC,QAAxB,CACArE,CAAS,CAACsE,MAAV,CAAiB,iDAAjB,CAAoE,CAACD,QAAQ,CAAEA,CAAX,CAApE,EACKE,IADL,CACU,SAACC,CAAD,CAAOC,CAAP,CAAc,CAChB,GAAIC,CAAAA,CAAS,CAAGtD,CAAI,CAACC,IAAL,CAAUP,CAAS,CAACI,SAApB,EAA+B,CAA/B,CAAhB,CACAlB,CAAS,CAAC2E,WAAV,CAAsBD,CAAtB,CAAiCF,CAAjC,CAAuCC,CAAvC,CACH,CAJL,EAKKT,MALL,CAKY,UAAM,CACVzC,CAAe,CAACH,CAAD,CAClB,CAPL,CAQH,CAdD,EAcG2C,IAdH,CAcQ,UAAM,CACVzB,CAAK,CAAC2B,IAAN,GACAhE,CAAmB,CAAC,aAAD,CAAgB,OAAhB,CACtB,CAjBD,CAkBH,CArBD,CA4BAwB,CAAW,CAACQ,SAAZ,CAAsB2C,IAAtB,CAA6B,UAAW,CACpC9E,CAAK,CAACmC,SAAN,CAAgB2C,IAAhB,CAAqBjD,IAArB,CAA0B,IAA1B,EAEA,GAA6B,IAAzB,QAAKC,eAAT,CAAmC,CAC/B,KAAKA,eAAL,CAAuB,IAC1B,CACD,GAAImB,CAAAA,CAAM,CAAG,KAAKC,SAAL,GAAiB3B,IAAjB,CAAsBP,CAAS,CAACG,MAAhC,EAAwC,CAAxC,CAAb,CACA8B,CAAM,CAAC8B,YAAP,CAAoB,UAApB,CAAgC,EAAhC,CACH,CARD,CAUA,GAAI,CAAC9E,CAAa,CAAC+E,GAAd,CAAkBrD,CAAW,CAACO,IAA9B,CAAL,CAA0C,CACtCjC,CAAa,CAACgF,QAAd,CAAuBtD,CAAW,CAACO,IAAnC,CAAyCP,CAAzC,CAAsD,mCAAtD,CACH,CAED,MAAOA,CAAAA,CACV,CA5IC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for the add save as modal.\n *\n * @module    mod_onlyofficeeditor/modal_saveas\n * @copyright  2022 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery', 'core/notification', 'core/custom_interaction_events', 'core/modal', 'core/modal_registry', 'core/templates'],\n    function($, Notification, CustomEvents, Modal, ModalRegistry, Templates) {\n\n        var displayNotification = function(error, type) {\n            require(['core/notification'], function(notification) {\n                require(['core/str'], function(str) {\n                    var errorIsAvailable = str.get_string(error, 'onlyofficeeditor');\n                    $.when(errorIsAvailable).done(function(localizedStr) {\n                        notification.addNotification({\n                            message: localizedStr,\n                            type: type\n                        });\n                    });\n                });\n            });\n        };\n\n        var SELECTORS = {\n            LOADING_ICON_CONTAINER: '[data-region=\"overlay-icon-container\"]',\n            SECTION: '.onlyofficeeditor-saveas-section',\n            BUTTON: '#onlyofficeeditor-saveas-button',\n            CONTAINER: '.container'\n        };\n\n        /**\n         * Show the loading spinner.\n         *\n         * @param  {jquery} body The body element.\n         */\n        var showLoadingIcon = function(body) {\n            body.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\n        };\n\n        /**\n         * Hide the loading spinner.\n         *\n         * @param  {jquery} body The body element.\n         */\n        var hideLoadingIcon = function(body) {\n            body.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalSaveas = function(root) {\n            Modal.call(this, root);\n            this.selectedSection = null;\n            this.saveAsData = null;\n            this.CMID = null;\n            this.courseid = null;\n        };\n\n        ModalSaveas.TYPE = 'mod_onlyofficeeditor-modal_saveas';\n        ModalSaveas.prototype = Object.create(Modal.prototype);\n        ModalSaveas.prototype.constructor = ModalSaveas;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalSaveas.prototype.registerEventListeners = function() {\n            Modal.prototype.registerEventListeners.call(this);\n\n            var modal = this;\n            this.getModal().on('click', SELECTORS.SECTION, function(e) {\n                var selected = modal.selectedSection;\n                if (selected !== null) {\n                    var previousSection = modal.getBody().find('#saveas-section-' + selected)[0];\n                    previousSection.classList.remove('onlyofficeeditor-saveas-section-selected');\n                }\n                var button = modal.getFooter().find(SELECTORS.BUTTON)[0];\n                button.removeAttribute('disabled');\n                e.target.classList.add('onlyofficeeditor-saveas-section-selected');\n                modal.selectedSection = parseInt(e.target.id.split('-')[2]);\n            }).bind(this);\n\n            this.getModal().on('click', SELECTORS.BUTTON, function() {\n                modal.saveAsData.section = modal.selectedSection;\n                $.ajax(M.cfg.wwwroot +\n                    `/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=saveas&cmid=${modal.CMID}`, {\n                    type: 'POST',\n                    dataType: 'json',\n                    data: modal.saveAsData,\n                }).done(() => {\n                    displayNotification('saveassuccess', 'success');\n                }).fail(() => {\n                    displayNotification('saveaserror', 'error');\n                }).always(() => {\n                    modal.hide();\n                });\n            }).bind(this);\n        };\n\n        ModalSaveas.prototype.renderSections = function(body, cmid, courseid) {\n            var modal = this;\n            showLoadingIcon(body);\n            $.ajax(M.cfg.wwwroot + `/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=sections&cmid=${cmid}`, {\n                type: 'GET',\n                dataType: 'json',\n                data: {courseid: courseid}\n            }).done((response) => {\n                var sections = response.sections;\n                Templates.render('mod_onlyofficeeditor/modal_saveas_sections_list', {sections: sections})\n                    .then((html, js) => {\n                        var container = body.find(SELECTORS.CONTAINER)[0];\n                        Templates.replaceNode(container, html, js);\n                    })\n                    .always(() => {\n                        hideLoadingIcon(body);\n                    });\n            }).fail(() => {\n                modal.hide();\n                displayNotification('saveaserror', 'error');\n            });\n        };\n\n        /**\n         * Override the modal show function to load the form when this modal is first shown.\n         *\n         * @method show\n         */\n        ModalSaveas.prototype.show = function() {\n            Modal.prototype.show.call(this);\n\n            if (this.selectedSection !== null) {\n                this.selectedSection = null;\n            }\n            var button = this.getFooter().find(SELECTORS.BUTTON)[0];\n            button.setAttribute('disabled', '');\n        };\n\n        if (!ModalRegistry.get(ModalSaveas.TYPE)) {\n            ModalRegistry.register(ModalSaveas.TYPE, ModalSaveas, 'mod_onlyofficeeditor/modal_saveas');\n        }\n\n        return ModalSaveas;\n    });\n"],"file":"modal_saveas.min.js"}
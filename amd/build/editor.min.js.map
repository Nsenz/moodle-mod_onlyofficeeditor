<<<<<<< HEAD
{"version":3,"sources":["../src/editor.js"],"names":["define","$","displayError","error","require","notification","str","errorIsAvailable","get_string","when","done","localizedStr","addNotification","message","type","urlParam","name","results","RegExp","exec","window","location","href","decodeURI","replaceActionLink","linkParam","link","actionIndex","indexOf","substring","encodeURIComponent","data","init","courseid","cmid","DocsAPI","ajaxUrl","M","cfg","wwwroot","getJSON","actionType","actionData","config","events","onMakeActionLink","event","action","docEditor","setActionLink","onRequestUsers","setUsers","usersToMention","onRequestSendNotify","comment","emails","replacedActionLink","actionLink","ajax","dataType","fail","userstomention","DocEditor"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* @package    mod_onlyofficeeditor\n * @copyright  2022 Ascensio System SIA <integration@onlyoffice.com>\n * @copyright  based on work by 2018 Olumuyiwa Taiwo <muyi.taiwo@logicexpertise.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\ndefine(['jquery'], function($) {\n    var displayError = function(error) {\n        require(['core/notification'], function(notification) {\n            require(['core/str'], function(str) {\n                var errorIsAvailable = str.get_string(error, 'onlyofficeeditor');\n                $.when(errorIsAvailable).done(function(localizedStr) {\n                    notification.addNotification({\n                        message: localizedStr,\n                        type: 'error'\n                    });\n                });\n            });\n        });\n    };\n\n    $.urlParam = function(name) {\n        var results = new RegExp('[\\\\?&]' + name + '=([^&#]*)').exec(window.location.href);\n        if (results === null) {\n            return null;\n        }\n        return decodeURI(results[1]) || 0;\n    };\n\n    var replaceActionLink = function(href, linkParam) {\n        var link;\n        var actionIndex = href.indexOf(\"&actionType=\");\n        if (actionIndex != -1) {\n            link = href.substring(0, actionIndex) + \"&actionType=\" + encodeURIComponent(linkParam.type) +\n                \"&actionData=\" + encodeURIComponent(linkParam.data);\n        } else {\n            link = href + \"&actionType=\" + encodeURIComponent(linkParam.type) + \"&actionData=\" + encodeURIComponent(linkParam.data);\n        }\n        return link;\n    };\n\n    return {\n        init: function(courseid, cmid) {\n            if (typeof DocsAPI === \"undefined\") {\n                displayError('docserverunreachable');\n                return;\n            }\n            var ajaxUrl = M.cfg.wwwroot + '/mod/onlyofficeeditor/dsconfig.php';\n            $.getJSON(ajaxUrl, {\n                courseid: courseid,\n                cmid: cmid,\n                actionType: $.urlParam('actionType'),\n                actionData: $.urlParam('actionData')\n            }).done(function(data) {\n                let config = data.config;\n\n                var onMakeActionLink = function(event) {\n                    var actionData = event.data.action;\n                    docEditor.setActionLink(replaceActionLink(location.href, actionData));\n                };\n                config.events = {\n                    'onMakeActionLink': onMakeActionLink\n                };\n\n                var onRequestUsers = function() {\n                    docEditor.setUsers({'users': usersToMention});\n                };\n\n                var onRequestSendNotify = function(event) {\n                    var comment = event.data.message;\n                    var emails = event.data.emails;\n                    var replacedActionLink = replaceActionLink(location.href, event.data.actionLink.action);\n\n                    var mentionData = {\n                        comment: comment,\n                        emails: emails,\n                        link: replacedActionLink,\n                        courseid: courseid\n                    };\n\n                    $.ajax(M.cfg.wwwroot + '/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=mention&cmid=' + cmid, {\n                        type: 'POST',\n                        dataType: 'json',\n                        data: mentionData\n                    }).fail(() => {\n                        displayError('onmentionerror');\n                    });\n                };\n\n                var usersToMention = data.userstomention;\n                if (usersToMention !== null) {\n                    config.events.onRequestUsers = onRequestUsers;\n                    config.events.onRequestSendNotify = onRequestSendNotify;\n                }\n\n                // eslint-disable-next-line no-undef\n                var docEditor = new DocsAPI.DocEditor(\"onlyofficeeditor-editor\", config);\n            });\n        }\n    };\n});\n"],"file":"editor.min.js"}
=======
{"version":3,"sources":["../src/editor.js"],"names":["define","$","displayError","error","require","str","errorIsAvailable","get_string","when","done","localizedStr","text","addClass","init","courseid","cmid","DocsAPI","ajaxUrl","M","cfg","wwwroot","getJSON","config","favicon","documentType","fileType","document","head","innerHTML","DocEditor"],"mappings":"AAsBAA,OAAM,+BAAC,CAAC,QAAD,CAAD,CAAa,SAASC,CAAT,CAAY,CAC3B,GAAIC,CAAAA,CAAY,CAAG,SAASC,CAAT,CAAgB,CAC/BC,OAAO,CAAC,CAAC,UAAD,CAAD,CAAe,SAASC,CAAT,CAAc,CAChC,GAAIC,CAAAA,CAAgB,CAAGD,CAAG,CAACE,UAAJ,CAAeJ,CAAf,CAAsB,kBAAtB,CAAvB,CACAF,CAAC,CAACO,IAAF,CAAOF,CAAP,EAAyBG,IAAzB,CAA8B,SAASC,CAAT,CAAuB,CACjDT,CAAC,CAAC,0BAAD,CAAD,CAA8BU,IAA9B,CAAqCD,CAArC,CACAT,CAAC,CAAC,0BAAD,CAAD,CAA8BU,IAA9B,CAAmCD,CAAnC,EAAiDE,QAAjD,CAA0D,OAA1D,CACH,CAHD,CAIH,CANM,CAOV,CARD,CAUA,MAAO,CACHC,IAAI,CAAE,cAASC,CAAT,CAAmBC,CAAnB,CAAyB,CAC3B,GAAuB,WAAnB,QAAOC,CAAAA,OAAX,CAAoC,CAChCd,CAAY,CAAC,sBAAD,CAAZ,CACA,MACH,CACD,GAAIe,CAAAA,CAAO,CAAGC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,oCAA9B,CACAnB,CAAC,CAACoB,OAAF,CAAUJ,CAAV,CAAmB,CACfH,QAAQ,CAAEA,CADK,CAEfC,IAAI,CAAEA,CAFS,CAAnB,EAGGN,IAHH,CAGQ,SAASa,CAAT,CAAiB,CACrB,GAAIC,CAAAA,CAAO,CAAGD,CAAM,CAACE,YAArB,CACA,GAAwB,OAApB,GAAAF,CAAM,CAACG,QAAP,EAAmD,OAApB,GAAAH,CAAM,CAACG,QAA1C,CAAgE,CAC5DF,CAAO,CAAGD,CAAM,CAACG,QACpB,CACDC,QAAQ,CAACC,IAAT,CAAcC,SAAd,EAA2B,6EACrBL,CADqB,CACX,WADhB,CAGA,GAAIP,CAAAA,OAAO,CAACa,SAAZ,CAAsB,yBAAtB,CAAiDP,CAAjD,CACH,CAZD,CAaH,CApBE,CAsBV,CAjCK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* @package    mod_onlyofficeeditor\n * @copyright  2022 Ascensio System SIA <integration@onlyoffice.com>\n * @copyright  based on work by 2018 Olumuyiwa Taiwo <muyi.taiwo@logicexpertise.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\ndefine(['jquery'], function($) {\n    var displayError = function(error) {\n        require(['core/str'], function(str) {\n            var errorIsAvailable = str.get_string(error, 'onlyofficeeditor');\n            $.when(errorIsAvailable).done(function(localizedStr) {\n                $(\"#onlyofficeeditor-editor\").text = localizedStr;\n                $(\"#onlyofficeeditor-editor\").text(localizedStr).addClass(\"error\");\n            });\n        });\n    };\n\n    return {\n        init: function(courseid, cmid) {\n            if (typeof DocsAPI === \"undefined\") {\n                displayError('docserverunreachable');\n                return;\n            }\n            var ajaxUrl = M.cfg.wwwroot + '/mod/onlyofficeeditor/dsconfig.php';\n            $.getJSON(ajaxUrl, {\n                courseid: courseid,\n                cmid: cmid\n            }).done(function(config) {\n                var favicon = config.documentType;\n                if (config.fileType === 'docxf' || config.fileType === 'oform') {\n                    favicon = config.fileType;\n                }\n                document.head.innerHTML += '<link type=\"image/x-icon\" rel=\"icon\" href=\"/mod/onlyofficeeditor/pix/'\n                    + favicon + '.ico\" />';\n                // eslint-disable-next-line no-undef\n                new DocsAPI.DocEditor(\"onlyofficeeditor-editor\", config);\n            });\n        }\n    };\n});\n"],"file":"editor.min.js"}
>>>>>>> remotes/origin/develop

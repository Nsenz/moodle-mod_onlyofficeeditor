{"version":3,"sources":["../src/editor.js"],"names":["define","$","displayNotification","error","type","require","notification","str","errorIsAvailable","get_string","when","done","localizedStr","addNotification","message","saveAsModal","displaySaveAsModal","saveAsData","cmid","courseid","Templates","ModalFactory","ModalSaveas","trigger","create","TYPE","modal","CMID","renderSections","getBody","show","init","DocsAPI","ajaxUrl","M","cfg","wwwroot","getJSON","data","docEditor","config","canAddInstance","addinstance","innerAlert","inEditor","console","log","showMessage","events","onAppReady","onError","event","onRequestSaveAs","title","url","section","document","fileType","DocEditor","version","split"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module mod_onlyofficeeditor/editor\n * @copyright  2022 Ascensio System SIA <integration@onlyoffice.com>\n * @copyright  based on work by 2018 Olumuyiwa Taiwo <muyi.taiwo@logicexpertise.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery'], function($) {\n    var displayNotification = function(error, type) {\n        require(['core/notification'], function(notification) {\n            require(['core/str'], function(str) {\n                var errorIsAvailable = str.get_string(error, 'onlyofficeeditor');\n                $.when(errorIsAvailable).done(function(localizedStr) {\n                    notification.addNotification({\n                        message: localizedStr,\n                        type: type\n                    });\n                });\n            });\n        });\n    };\n\n    var saveAsModal = null;\n\n    var displaySaveAsModal = function(saveAsData, cmid, courseid) {\n        require(['jquery', 'core/templates', 'core/modal_factory', 'mod_onlyofficeeditor/modal_saveas'],\n            function($, Templates, ModalFactory, ModalSaveas) {\n                var trigger = $('.onlyofficeeditor-container');\n                if (saveAsModal === null) {\n                    saveAsModal = ModalFactory.create({\n                        type: ModalSaveas.TYPE\n                    }, trigger);\n                }\n                saveAsModal.done((modal) => {\n                    modal.courseid = courseid;\n                    modal.CMID = cmid;\n                    modal.saveAsData = saveAsData;\n                    modal.renderSections(modal.getBody(), cmid, courseid);\n                    modal.show();\n                });\n            });\n    };\n\n    return {\n        init: function(courseid, cmid) {\n            if (typeof DocsAPI === \"undefined\") {\n                displayNotification('docserverunreachable', 'error');\n                return;\n            }\n            var ajaxUrl = M.cfg.wwwroot + '/mod/onlyofficeeditor/dsconfig.php';\n            $.getJSON(ajaxUrl, {\n                courseid: courseid,\n                cmid: cmid\n            }).done(function(data) {\n                var docEditor = null;\n                var config = data.config;\n                var canAddInstance = data.addinstance;\n\n                const innerAlert = (message, inEditor) => {\n                    // eslint-disable-next-line no-console\n                    if (console && console.log) {\n                        // eslint-disable-next-line no-console\n                        console.log(message);\n                    }\n                    if (inEditor && docEditor) {\n                        docEditor.showMessage(message);\n                    }\n                };\n                const onAppReady = () => {\n                    innerAlert(\"Document editor ready\");\n                };\n\n                const onError = (event) => {\n                    if (event) {\n                        innerAlert(event.data);\n                    }\n                };\n                config.events = {\n                    'onAppReady': onAppReady,\n                    'onError': onError\n                };\n\n                var onRequestSaveAs = function(event) {\n                    var saveAsData = {\n                        title: event.data.title,\n                        url: event.data.url,\n                        courseid: courseid,\n                        section: null\n                    };\n                    displaySaveAsModal(saveAsData, cmid, courseid);\n                };\n\n                if (canAddInstance) {\n                    config.events.onRequestSaveAs = onRequestSaveAs;\n                }\n\n                if ((config.document.fileType === \"docxf\" || config.document.fileType === \"oform\")\n                    // eslint-disable-next-line no-undef\n                    && DocsAPI.DocEditor.version().split(\".\")[0] < 7) {\n                    displayNotification('oldversion', 'error');\n                } else {\n                    // eslint-disable-next-line no-undef\n                    docEditor = new DocsAPI.DocEditor(\"onlyofficeeditor-editor\", config);\n                }\n            });\n        }\n    };\n});\n"],"file":"editor.min.js"}